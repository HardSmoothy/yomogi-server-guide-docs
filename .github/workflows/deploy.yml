name: Docusaurus

on:
    workflow_dispatch:
    push:
        branches: [ main ]
    pull_request:
        branches: [ main ]

env:
    SOURCE_FOLDER: /

jobs:
    checks:
        if: github.event_name != 'push'
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v4
            -   uses: actions/setup-node@v4
                with:
                    node-version: '18.x'
            -   name: Test Build
                run: |
                    if [ -e yarn.lock ]; then
                      yarn install --frozen-lockfile
                    elif [ -e package-lock.json ]; then
                      npm ci
                    else
                      npm i
                    fi
                    npm run build
                working-directory: ${{env.SOURCE_FOLDER}}
    gh-release:
        if: github.event_name != 'pull_request'
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v4
            -   uses: actions/setup-node@v4
                with:
                    node-version: '18.x'
            -   uses: webfactory/ssh-agent@v0.5.0
                with:
                    ssh-private-key: ${{ secrets.GH_PAGES_DEPLOY }}
            -   name: Release to GitHub Pages
                env:
                    USE_SSH: true
                    GIT_USER: git
                run: |
                    git config --global user.email "51500566+aida0710@users.noreply.github.com"
                    git config --global user.name "zzz"
                    if [ -e yarn.lock ]; then
                      yarn install --frozen-lockfile
                    elif [ -e package-lock.json ]; then
                      npm ci
                    else
                      npm i
                    fi
                    npm run deploy
                working-directory: ${{env.SOURCE_FOLDER}}
